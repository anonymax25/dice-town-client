<div class="v-flex game-container">

    <h2 class="text-center">
        {{lobby.game.status === gameStatus.DICE_ROLLING ? 'Rolling Dices' : 'Results'}}
        <div class="spinner-border" style="border-width: 2px;" *ngIf="lobby.game.status !== gameStatus.DICE_ROLLING"></div>
    </h2>
    <div>
        <div class="board">
            <mat-card style="background-image: url(../../../../assets/images/mine.jpg);">
                
                <img src="../../../../assets/icons/nugget.png" height="50px" alt="nuggets" class="light-bg mb-2">
                
                <mat-card-content class="light-bg m-0 p-2 text-center">
                    <p class="font-size-header">
                        {{lobby.game.nuggets}}
                    </p>
                    (remaining)
                </mat-card-content>
            </mat-card>
            
            <mat-card style="background-image: url(../../../../assets/images/bank.jpg); background-position:center;">
                
                <img src="../../../../assets/icons/money.png" height="40px" alt="dollars" class="light-bg mb-3">
                
                <mat-card-content>
                    <div class="light-bg m-0 p-2 text-center ">
                        <p class="m-2">
                            At stake: <strong>{{lobby.game.dollar}}</strong>$
                        </p>
                        <p class="m-2">
                            Build-up: <strong>{{lobby.game.income}}</strong>$
                        </p>
                    </div>
                </mat-card-content>
            </mat-card>
            
            <mat-card>
                <p>General storms</p>
                <mat-card-content>
                </mat-card-content>
            </mat-card>
            
            <mat-card>
                <p>Saloon</p>
                <mat-card-content>
                </mat-card-content>
            </mat-card>
            <mat-card style="background-image: url(../../../../assets/images/wood-bg.jpg); background-position:center;">
                <div class="light-bg mb-3 p-1">
                    <img src="../../../../assets/icons/sherif-badge.png" height="40px" alt="sherif" class="">
                </div>
                
                <mat-card-content class="light-bg m-0 p-2 text-center">
                    {{ lobby.game.sherifUserid ? getSherif().name : "No one currently"}} is the sherif
                </mat-card-content>
            </mat-card>
            <mat-card>
                <p>Property</p>
                <mat-card-content>
                    <div>
                        remaining cards: {{lobby.game.property.length - 3}}
                    </div>
                    <br>
                    <span *ngFor="let property of getFirst3properties()" class="property">
                        {{property.value}}
                    </span>
                </mat-card-content>
            </mat-card>
            
            <mat-card>
                <p>Bad luck :'(</p>
                <mat-card-content>
                </mat-card-content>
            </mat-card>
        </div>
        
    </div>


    
    <div class="player-panel">
        Other players:
        <div *ngFor="let player of getOtherPlayers()" class="player-item col-6 col-xs-12 mb-1">
            <b style="flex: 0;">
                {{getUserOfPlayer(player).name}}&nbsp; 
            </b>
            <span style="flex: 1;" *ngIf="isWaitingForPlayer(player)">
                is {{getStatusOfPlayer(player).toLowerCase()}}...
            </span>
            <div class="player-item" style="flex: 0;">
                <app-dice style="justify-self: flex-end;" *ngFor="let dice of nonHiddenDices(player.dices); let i = index" [isSelected]="false" [number]="dice.value"></app-dice>
            </div>
        </div>

    </div>



    <div class="your-game">
        <h2>Your hand:</h2>
        <div>
            <div *ngIf="getPlayer() as player">
                <div class="hand">
                    <mat-card style="background-image: url(../../../../assets/images/mine.jpg);">
                
                        <img src="../../../../assets/icons/nugget.png" height="50px" alt="nuggets" class="light-bg mb-2">
                        
                        <mat-card-content class="light-bg p-2 text-center strong col-6 offset-3">
                            <p class="font-size-header">
                                {{player.nuggets}}
                            </p>
                        </mat-card-content>
                    </mat-card>
                    
                    <mat-card style="background-image: url(../../../../assets/images/bank.jpg); background-position:center;">
                
                        <img src="../../../../assets/icons/money.png" height="40px" alt="dollars" class="light-bg mb-3">
                        
                        <mat-card-content>
                            <div class="light-bg p-2 text-center strong col-6 offset-3">
                                <p class="font-size-header mb-0">
                                    {{player.dollar}} $
                                </p>
                            </div>
                        </mat-card-content>
                    </mat-card>
                    
                    <mat-card *ngIf="player.generalStorms.length">
                        <p>General storms</p>
                        <mat-card-content>
                        </mat-card-content>
                    </mat-card>
                    

                    <mat-card *ngIf="getSherif() && getSherif().id === player.userId">
                        <img src="../../../../assets/icons/sherif-badge.png" height="40px" alt="dollars">
                        <mat-card-content>
                            You are the sherif!
                        </mat-card-content>
                    </mat-card>

                    <mat-card *ngIf="player.property.length">
                        <p>Properties</p>
                        <mat-card-content>
                            <span *ngFor="let property of player.property" class="property">
                                {{property.value}}
                            </span>
                        </mat-card-content>
                    </mat-card>
                    
                    <mat-card *ngIf="player.badLuck.length">
                        <p>Bad luck :'(</p>
                        <mat-card-content>
                            <span *ngFor="let property of player.badLuck" class="property">
                                {{property.text}}
                            </span>
                        </mat-card-content>
                    </mat-card>

                    <mat-card style="flex: 2;">
                        <div class="mb-1">
                            <span class="dice-headers">
                                <div>
                                    <span class="h2 pr-0">
                                        Dices
                                    </span>
                                    <span *ngIf="lobby.game.waitingFor.length">
                                        &nbsp;-&nbsp;Waiting for: <strong *ngFor="let name of getNameWaitingFor()">{{name}}&nbsp;</strong> 
                                        <span class="spinner-border" style="border-width: 2px;"></span>
                                    </span>
                                </div>
                                <div *ngIf="player.dices.length !== 5">
                                    <button mat-raised-button color="primary" class="mr-2" [disabled]="!player.canThrowDices || player.dices.length === 5" (click)="rollDices()"><mat-icon>casino</mat-icon> Roll</button>
                                    <button mat-raised-button color="accent" [disabled]="player.canThrowDices || player.dices.length === 5 || isDiceChosen || isCostError" (click)="validateDiceChoice()"><mat-icon>check</mat-icon> Validate</button>
                                </div>
                            </span>
                        </div>
                        <mat-card-content class="dice-headers">

                            
                            
                            <div *ngIf="rollingDices">
                                <mat-spinner></mat-spinner>
                            </div>


                            <div *ngIf="newDices.length && !rollingDices && player.dices.length < 5">
                                <mat-divider></mat-divider>
                                <h4>Rolled:  
                                    <ng-container *ngIf="isCostError; else validCost">
                                        <span class="alert">Not enough money: {{player.dollar}}$ - {{costs}}$ = {{player.dollar-costs}}$</span>
                                    </ng-container>
                                    <ng-template #validCost>
                                        {{costs > 0 ? '-'+costs+'$' : 'FREE'}}
                                    </ng-template>
                                </h4>
                                <div class="dices-container" >
                                    <span [ngClass]="!selectedDice.length ? 'selected' : 'unSelected'">
                                        <button mat-stroked-button (click)="selectDice(-1)" class="square-btn">None</button>
                                    </span>
                                    <app-dice *ngFor="let dice of newDices; let i = index" [isSelected]="isDiceSelected(i)" [number]="dice.value" (click)="selectDice(i)"></app-dice>
                                </div>
                            </div>

                            
                            <div *ngIf="player.dices && player.dices.length">
                                <mat-divider class="mb-5"></mat-divider>
                                <h4 *ngIf="lobby.game.status === 'DICE_ROLLING'">Saved</h4>
                                <div class="dices-container">
                                    <app-dice *ngFor="let dice of player.dices; let i = index" [isSelected]="false" [number]="dice.value"></app-dice>
                                </div>
                            </div>


                        </mat-card-content>
                    </mat-card>
                </div>
            </div>
        </div>
    </div>
</div>
